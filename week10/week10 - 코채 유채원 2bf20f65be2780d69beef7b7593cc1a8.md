# week10 - 코채/유채원

- GitHub Actions와 AWS EC2를 이용하여 직접 CI/CD 배포 해보기!
    
    ![image.png](image.png)
    
    ![image.png](image%201.png)
    
    VPC,  서브넷 생성( 이 외에도, 라우팅 테이블, 게이트웨이 등도 설정 완료)
    
    ![image.png](image%202.png)
    
    보안그룹 설정 완료
    
    ![image.png](image%203.png)
    
    🚨 User ⇒ ubuntu 에서 대소문자 구분 필수
    
    🚨 ssh 연결 끊김 오류 ⇒ RAM 부족으로 인한 오류
    
    해결 방법: 인스턴스 중형 변경 → 프리티어 저용량에서 n7i-felx-large로 변경
    
    (물론 swap 파일 수정 방법을 사용하셔도 됩니다)
    
    ![image.png](image%204.png)
    
    ![image.png](image%205.png)
    
    ![image.png](image%206.png)
    
    ![image.png](image%207.png)
    
    ![image.png](image%208.png)
    
    ![image.png](image%209.png)
    
    ![image.png](image%2010.png)
    
    ssh 로 접속하여 .env 파일을 생성하고 run 해줍니다다
    
    ![image.png](image%2011.png)
    
    이제 localhost가 아니라 aws instance ip주소로 접근이 됩니다 
    
    ![image.png](image%2012.png)
    

---

- EC2를 이용해 배포한 현재 상태에서 Google 로그인이 동작하지 않는 이유를 확인하고 수정해보기.
    
    ![image.png](image%2013.png)
    
    저는 배포 후에 google social login 접속 시에 다음과 같은 에러 창이 떴습니다.
    
    에러 발생 이유는 Google OAuth 로그인 후 **Redirect URI(리디렉션 주소)** 로 브라우저가 이동하기 때문입니다.
    
    Google OAuth는 로그인 후 반드시 **등록된 Redirect URI** 로 사용자를 돌려보내야 합니다.
    
    현재 설정된 Redirect URI가 [localhost:3000](http://localhost:3000) 이었기 때문에
    
    Google 로그인 완료 → 브라우저가 위 주소로 이동 →
    
    **하지만 로컬에 서버가 없으므로 해당 주소가 응답하지 않음**
    
    즉, **OAuth 프로세스의 마지막 단계(Authorization Code를 서버가 받는 단계)를 처리할 서버가 존재하지 않기 때문에 로그인 절차가 완료될 수 없습니다.**
    
    ---
    
    OAuth 인증 과정은 다음과 같습니다:
    
    1. 사용자 → Google 로그인
    2. Google → Redirect URI 로 Authorization Code 전달
    3. **서버가 이 Authorization Code를 받아 Access Token을 요청함**
    
    여기서 3번을 수행할 “서버”가 localhost에 없으면 OAuth 흐름이 중단되어 버립니다.
    
    ---
    
      결론!!!!
    
    - Google OAuth는 로그인 후 **반드시 Redirect URI로 이동해야 함**
    - 그 URI가 `localhost:3000`이라면 **로컬 서버가 떠 있어야 정상 동작함**
    - 서버가 없으면 OAuth의 토큰 교환 단계가 불가능함 → 로그인 실패
    
    ```
    http://54.180.140.210/oauth2/callback/google
    ```
    
    ![image.png](image%2014.png)
    
    ![image.png](image%2015.png)
    
    ![image.png](image%2016.png)
    
    ![image.png](image%2017.png)