# [Week07]-ì½”ì±„/ìœ ì±„ì›

- ì„±ê³µ ì‘ë‹µ (í‘œì¤€ ê·œê²©ìœ¼ë¡œ ì˜ ì‘ë‹µì´ ìƒì„±ë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ìˆ˜ì •)
    
    ```jsx
    //mission.controller.js
    res.status(StatusCodes.OK).success(mission);
    res.status(StatusCodes.OK).success(challenge);
    res.status(StatusCodes.OK).success(missions);
    res.status(StatusCodes.OK).success(challenges);
    res.status(StatusCodes.OK).success(completedChallenge);
    ```
    
    ```jsx
    //review.controller.js
    res.status(StatusCodes.OK).success(review);
    res.status(StatusCodes.OK).success(reviews);
    ```
    
    ```jsx
    //store.controller.js
    res.status(StatusCodes.OK).success(store);
    ```
    
    ![image.png](image.png)
    
    ![image.png](image%201.png)
    
    ![image.png](image%202.png)
    
    ![image.png](image%203.png)
    
    ![image.png](image%204.png)
    
    ![image.png](image%205.png)
    
    ![image.png](image%206.png)
    
    ![image.png](image%207.png)
    
    ![image.png](image%208.png)
    
    â†’ ëª¨ë“  ì„±ê³µ ì‘ë‹µ í˜•ì‹ì´ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ˜Š
    
- ì˜¤ë¥˜ ì²˜ë¦¬ ì ê²€, ì˜¤ë¥˜ê°€ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ë“¤ì€ ì»¤ìŠ¤í…€ Error ê°ì²´ë¥¼ ì„ ì–¸í•´ ë˜ì§€ë„ë¡ ë¦¬íŒ©í† ë§
    
    ```jsx
    //store.service.js
    if (createdStoreId === null) {
      throw new DuplicateStoreIdError("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ê°€ê²Œì…ë‹ˆë‹¤.", data);
    }
    ```
    
    ```jsx
    //review.service.js
    if (createdReviewId === null) {
      throw new noExistsStore("í•´ë‹¹ ê°€ê²Œê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.", data);
    }
    ```
    
    ```jsx
    //mission.service.js
    if (createdChallengeId === null) {
      throw new missionAlreadyInProgressError("ì´ë¯¸ ì§„í–‰ì¤‘ì¸ ë¯¸ì…˜ì…ë‹ˆë‹¤", data);
    }
    if (!userMission) {
      throw new ChallengeNotFoundError(
        "í•´ë‹¹ ë¯¸ì…˜ì— ëŒ€í•œ ë„ì „ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",
        data
      );
    }
    
    if (userMission.status === "completed") {
      throw new ChallengeAlreadyCompletedError("ì´ë¯¸ ì™„ë£Œëœ ë¯¸ì…˜ì…ë‹ˆë‹¤.", data);
    }
    ```
    
    ```jsx
    //errors.js
    export class DuplicateUserEmailError extends Error {
      errorCode = "U001";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class DuplicateStoreIdError extends Error {
      errorCode = "U002";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class NoExistsStoreError extends Error {
      errorCode = "U003";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class MissionAlreadyInProgressError extends Error {
      errorCode = "U004";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class ChallengeNotFoundError extends Error {
      errorCode = "U005";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class ChallengeAlreadyCompletedError extends Error {
      errorCode = "U006";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    ```
    
    ![image.png](image%209.png)
    
    ![image.png](image%2010.png)
    
    ![image.png](image%2011.png)
    
    â†’ ëª¨ë“  ì—ëŸ¬ ì‘ë‹µ í˜•ì‹ì´ í†µì¼ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ˜Š
    
- morgan, cookie-parser â†’ app.use()ë¡œ ì ìš©
    
    ![image.png](image%2012.png)
    
- ì¶”ê°€ ë¦¬íŒ©í† ë§
    1. 7ì£¼ì°¨ ë¦¬íŒ©í† ë§ ì§„í–‰ ë„ì¤‘, [íšŒì›ê°€ì…] ì‹œì— ì„ í˜¸ ì¹´í…Œê³ ë¦¬ê°€ ì˜ëª»ëœ ê°’ìœ¼ë¡œ ì „ë‹¬ë˜ë©´(ex ì»¬ëŸ¼ ì•„ì˜ˆ ë¹ ì§, ë¬¸ìì—´, í˜•ì‹ ë¶ˆì¼ì¹˜ ë“±) ë¶„ëª…, FAILì´ ëœ¨ëŠ”ë° DBì—ëŠ” íšŒì›ì •ë³´ê°€ ì €ì¥ì´ ë˜ëŠ” ë¬¸ì œ ë°œìƒ
        
        â†’ ì´ë¥¼ prisma.$transaction(prismaTx)ë¥¼ í†µí•´ ì‘ì—…ì„ í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ìœ¼ë¡œ ë¬¶ì–´, ë¬¸ì œ í•´ê²°
        
    
    ![image.png](image%2013.png)
    
    ```jsx
    export const userSignUp = async (data) => {
      return await prisma.$transaction(async (prismaTx) => {
        const existingUser = await prismaTx.user.findUnique({
          where: { email: data.email },
        });
        if (existingUser) {
          throw new Error("ì´ë¯¸ ì¡´ì¬í•˜ëŠ” ì´ë©”ì¼ì…ë‹ˆë‹¤.");
        }
    
        const joinUserId = await addUser(
          {
            email: data.email,
            name: data.name,
            gender: data.gender,
            birth: data.birth,
            address: data.address,
            detailAddress: data.detailAddress,
            phoneNumber: data.phoneNumber,
          },
          prismaTx // íŠ¸ëœì­ì…˜ ì „ë‹¬
        );
    
        for (const preference of data.preferences) {
          await setPreference(joinUserId, preference, prismaTx);
        }
    
        const user = await getUser(joinUserId, prismaTx);
        const preferences = await getUserPreferencesByUserId(joinUserId, prismaTx);
    
        return responseFromUser({ user, preferences });
      });
    };
    ```
    
    1. ì„±ê³µ ì‘ë‹µ í…ŒìŠ¤íŠ¸ ì¤‘, scoreê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŒì—ë„ ì €ì¥ë˜ëŠ” ë¬¸ì œ ë°œê²¬
        
        ì´ë ‡ê²Œ í•„ìˆ˜ì‘ë‹µ ë¯¸ì…ë ¥ ê²€ì¦ì€
        
        1. í´ë¼ì´ì–¸íŠ¸ ì¸¡ì—ì„œ ê²€ì¦
        2. DB ê²€ì¦
        3. ì„œë²„ì—ì„œ ê²€ì¦
        
        ì´ í•„ìš”í•˜ê¸° ë•Œë¬¸ì—, service layerì—ì„œ error ê°ì²´ë¥¼ ë˜ì§€ë„ë¡ ì¶”ê°€í•¨
        
    
    ```jsx
    if (data.score == null) {
        throw new ScoreNotProvidedError("ì ìˆ˜ê°€ ì…ë ¥ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤", data);
      }
    
      if (data.score < 0 || data.score > 5) {
        throw new ScoreOutOfRangeError("ì ìˆ˜ëŠ” 0ì—ì„œ 5 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.", data);
      }
    ```
    
    ```jsx
    export class ScoreNotProvidedError extends Error {
      errorCode = "U007";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    export class ScoreOutOfRangeError extends Error {
      errorCode = "U008";
    
      constructor(reason, data) {
        super(reason);
        this.reason = reason;
        this.data = data;
      }
    }
    ```
    
    ![image.png](image%2014.png)
    
    ![image.png](image%2015.png)